<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>å³æ™‚ç•™è¨€ç‰†ï¼ˆç°¡å–®ç‰ˆï¼‰</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 700px; margin: 40px auto; }
        h1 { color: #444; }
        .message { border-bottom: 1px solid #ddd; padding: 10px 0; }
        .timestamp { color: #888; font-size: 0.9em; }
        #form { margin-top: 20px; }
        input, textarea { width: 100%; margin-top: 5px; padding: 8px; }
        button { margin-top: 10px; padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 5px; }
        button:hover { background-color: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ’¬ å³æ™‚ç•™è¨€ç‰†</h1>
    <div id="messages">Loading messages...</div>

    <div id="form">
        <h3>ç•™ä¸‹ä½ çš„è¨Šæ¯ï¼š</h3>
        <input type="text" id="name" placeholder="ä½ çš„åå­—">
        <textarea id="content" rows="3" placeholder="å¯«é»ä»€éº¼å§..."></textarea>
        <button onclick="sendMessage()">é€å‡ºç•™è¨€</button>
    </div>

    <script>
    async function fetchMessages() {
        const res = await fetch('/api/messages');
        const data = await res.json();
        const container = document.getElementById('messages');
        container.innerHTML = '';

        if (data.length === 0) {
            container.innerHTML = '<p>ç›®å‰é‚„æ²’æœ‰ç•™è¨€ã€‚</p>';
            return;
        }

        data.forEach(msg => {
            const el = document.createElement('div');
            el.className = 'message';
            el.innerHTML = `
                <strong>${escapeHtml(msg.name)}</strong>ï¼š
                ${escapeHtml(msg.content)}<br>
                <span class="timestamp">${msg.timestamp}</span>
            `;
            container.appendChild(el);
        });
    }

    async function sendMessage() {
        const name = document.getElementById('name').value.trim();
        const content = document.getElementById('content').value.trim();

        if (!name || !content) {
            alert('è«‹è¼¸å…¥åå­—å’Œå…§å®¹');
            return;
        }

        await fetch('/api/messages', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, content })
        });

        document.getElementById('content').value = '';
        fetchMessages(); // ç«‹å³æ›´æ–°ç•«é¢
    }

    function escapeHtml(str) {
        return str.replace(/[&<>"']/g, m => ({
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;'
        }[m]));
    }

    // å®šæ™‚æ¯ 5 ç§’åˆ·æ–°ä¸€æ¬¡ç•™è¨€
    fetchMessages();
    setInterval(fetchMessages, 5000);
    </script>
</body>
</html>
